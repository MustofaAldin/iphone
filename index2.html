<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>iPhone Store — 16 Pro Max (Responsive Dropdown + Cart Popover)</title>

    <!-- Anti FOUC untuk tema -->
    <script>
      (function () {
        try {
          const t = localStorage.getItem("theme");
          const dark = t === "dark" || (!t && window.matchMedia("(prefers-color-scheme: dark)").matches);
          if (dark) document.documentElement.classList.add("dark");
        } catch {}
      })();
    </script>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: { sans: ["Poppins", "ui-sans-serif", "system-ui"] },
            colors: {
              primary: "#1E3A8A",
              ink: "#0F172A",
              soft: "#EEF2FF",
              sky: "#2563EB",
              accent: "#FBBF24",
              pastel1: "#FDE3E1",
              pastel2: "#E7F6FF",
              pastel3: "#EAF8EC",
              pastel4: "#FFF4CE",
              slateSoft: "#F5F7FB",
            },
            boxShadow: {
              soft: "0 10px 30px rgba(28,52,84,.08)",
              glow: "0 10px 40px rgba(37,99,235,.35)",
            },
            keyframes: {
              blob: {
                "0%": { transform: "translate(0,0) scale(1)" },
                "33%": { transform: "translate(30px,-30px) scale(1.1)" },
                "66%": { transform: "translate(-20px,20px) scale(0.95)" },
                "100%": { transform: "translate(0,0) scale(1)" },
              },
              floatY: { "0%,100%": { transform: "translateY(0)" }, "50%": { transform: "translateY(-10px)" } },
              ringSpin: { to: { transform: "rotate(360deg)" } },
            },
            animation: {
              blob: "blob 12s ease-in-out infinite",
              blob2: "blob 16s ease-in-out infinite",
              blob3: "blob 14s ease-in-out infinite",
              floatY: "floatY 4s ease-in-out infinite",
              ring: "ringSpin 16s linear infinite",
            },
          },
        },
      };
    </script>

    <style>
      /* Transisi halus seluruh halaman saat switch tema */
      html.theme-changing *,
      html.theme-changing *::before,
      html.theme-changing *::after {
        transition: background-color 600ms, color 600ms, border-color 600ms, fill 600ms, stroke 600ms, opacity 600ms;
      }

      /* 3D helpers */
      .persp-1200 { perspective: 1200px; }
      .scene-3d { transform-style: preserve-3d; will-change: transform; }
      .z-30deg { transform: translateZ(30px); }
      .z-50deg { transform: translateZ(50px); }
      .no-select { user-select: none; -webkit-user-drag: none; }

      /* Hilangkan tepi saat tilt */
      .edge-soft {
        -webkit-mask-image: radial-gradient(130% 112% at 50% 52%, #000 62%, rgba(0,0,0,.9) 78%, rgba(0,0,0,.6) 86%, transparent 96%);
                mask-image: radial-gradient(130% 112% at 50% 52%, #000 62%, rgba(0,0,0,.9) 78%, rgba(0,0,0,.6) 86%, transparent 96%);
      }
      #gloss {
        mix-blend-mode: screen;
        -webkit-mask-image: radial-gradient(78% 62% at 50% 50%, #000 62%, transparent 100%);
                mask-image: radial-gradient(78% 62% at 50% 50%, #000 62%, transparent 100%);
        will-change: background;
      }
      #iphoneImg {
        backface-visibility: hidden;
        transform-style: preserve-3d;
        image-rendering: -webkit-optimize-contrast;
        outline: 1px solid transparent;
      }
      .edge-vignette {
        pointer-events: none;
        position: absolute;
        inset: 0;
        border-radius: 2rem;
        z-index: 30;
        background: radial-gradient(120% 100% at 50% 50%, rgba(255,255,255,0) 70%, rgba(0,0,0,.05) 90%);
      }
      .dark .edge-vignette {
        background: radial-gradient(120% 100% at 50% 50%, rgba(0,0,0,0) 70%, rgba(0,0,0,.22) 92%);
      }

      /* ===== HEADER: blur halus + rounded + transisi biru ===== */
      #siteHeader { z-index: 80; }
      #siteHeader .glass{
        position: relative;
        border-radius: 1.5rem;
        isolation: isolate;
        overflow: visible;
        background: rgba(30,58,138,0.92);
        -webkit-backdrop-filter: saturate(1.1) blur(14px);
        backdrop-filter: saturate(1.1) blur(14px);
        border: 1px solid rgba(255,255,255,.06);
        transition:
          background-color 420ms ease,
          color 420ms ease,
          border-color 420ms ease,
          box-shadow 420ms ease,
          -webkit-backdrop-filter 280ms ease,
          backdrop-filter 280ms ease;
      }
      .dark #siteHeader .glass{
        background: rgba(30,41,59,0.88);
        border-color: rgba(255,255,255,.08);
      }
      #siteHeader .glass::before{
        content:"";
        position:absolute;
        inset: -28px -28px -8px -28px;
        border-radius: inherit;
        pointer-events:none;
        z-index:0;
        -webkit-backdrop-filter: blur(22px);
        backdrop-filter: blur(22px);
        background: linear-gradient(to bottom, rgba(38,77,181,.12), rgba(38,77,181,.04));
        -webkit-mask-image: linear-gradient(to bottom,
          rgba(0,0,0,1) 0%,
          rgba(0,0,0,.7) 55%,
          rgba(0,0,0,.25) 80%,
          rgba(0,0,0,0) 100%);
                mask-image: linear-gradient(to bottom,
          rgba(0,0,0,1) 0%,
          rgba(0,0,0,.7) 55%,
          rgba(0,0,0,.25) 80%,
          rgba(0,0,0,0) 100%);
      }
      #siteHeader .glass > *{ position: relative; z-index: 1; }
      #siteHeader.is-scrolled .glass{
        background: rgba(38,77,181,0.96);
        -webkit-backdrop-filter: saturate(1.15) blur(16px);
        backdrop-filter: saturate(1.15) blur(16px);
        border-color: rgba(255,255,255,.10);
        box-shadow: 0 10px 25px rgba(15,23,42,.12);
      }
      .dark #siteHeader.is-scrolled .glass{
        background: rgba(33,70,171,0.94);
        -webkit-backdrop-filter: saturate(1.15) blur(16px);
        backdrop-filter: saturate(1.15) blur(16px);
        border-color: rgba(255,255,255,.12);
        box-shadow: 0 10px 25px rgba(0,0,0,.45);
      }

      /* Dropdown desktop */
      .nav-item { position: relative; }
      .dropdown-panel{ color: #0F172A; }
      .dark .dropdown-panel{ color: #E2E8F0; }
      .dropdown-panel{ margin-top: 6px; }
      .dropdown-panel::before{
        content:"";
        position:absolute;
        left:0; right:0; top:-10px;
        height:12px; /* bridge untuk mouse */
      }
      .dropdown-link{ display:block; border-radius: 0.75rem; padding: 0.5rem 0.75rem; }
      .dropdown-link:hover{ background: rgba(15,23,42,0.06); }
      .dark .dropdown-link:hover{ background: rgba(148,163,184,0.16); }
      .nav-item.open .dropdown-panel { display: block !important; }
      .nav-item:hover .dropdown-panel { display: block !important; }

      /* Mobile accordion helpers */
      .mm-panel{ display: none; }
      .mm-item.open .mm-panel{ display: block; }
      .mm-chevron{ transition: transform .25s ease; }
      .mm-item.open .mm-chevron{ transform: rotate(180deg); }

      #cartPopover{ color: #0F172A; }
      .dark #cartPopover{ color: #E2E8F0; }

      #themeCurtain { transition: opacity 700ms ease; }

      /* ===== Fix: teks dropdown mobile mode light jadi gelap, dark tetap terang ===== */
#mobileMenu .mm-panel{
  color: #0F172A;              /* light */
}
.dark #mobileMenu .mm-panel{
  color: #E2E8F0;              /* dark */
}
/* pastikan link ikut mewarisi warna (tanpa jadi putih) */
#mobileMenu .mm-panel a{
  color: inherit;
}

    </style>
  </head>

  <body class="bg-[#D7DEEE] dark:bg-slate-950 antialiased text-ink dark:text-slate-100 selection:bg-sky/15">

    <!-- ===== Fixed Navbar ===== -->
    <header id="siteHeader" class="fixed top-0 inset-x-0">
      <div class="mx-auto max-w-[1200px]">
        <div class="glass mx-3 mt-3 sm:mx-6 sm:mt-4">
          <div class="bar p-3 sm:p-5 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="h-9 w-9 rounded-full bg-white/10 grid place-content-center ring-1 ring-white/20">
                  <img src="apple.png">
                </div>
                <span class="font-semibold text-xl tracking-tight">iPhone Store</span>
              </div>

              <!-- NAV DESKTOP (≥ lg) + DROPDOWNS -->
              <nav class="hidden lg:flex items-center gap-2 px-2 py-1.5 rounded-full">
                <!-- iPhone -->
                <div class="nav-item group">
                  <a href="#" class="flex items-center gap-2 px-4 py-2 rounded-full text-white/90 hover:text-white hover:bg-white/10 transition">
                    <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M3 7h18l-1.5 11a2 2 0 0 1-2 2H6.5a2 2 0 0 1-2-1.7L3 7Z" /><path d="M8 7V4a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v3" /></svg>
                    <span class="font-medium">iPhone</span>
                  </a>
                  <div class="dropdown-panel absolute left-0 top-full hidden z-[95]">
                    <div class="w-[720px] max-w-[92vw] rounded-2xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-4 grid grid-cols-2 gap-3 shadow-soft">
                      <div>
                        <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-2">Terbaru</p>
                        <ul class="space-y-1.5">
                          <li><a href="#" class="dropdown-link flex items-center justify-between"><span>iPhone 16 Pro Max</span><span class="text-xs text-sky">Baru</span></a></li>
                          <li><a href="#" class="dropdown-link">iPhone 16 Pro</a></li>
                          <li><a href="#" class="dropdown-link">iPhone 16 Plus</a></li>
                          <li><a href="#" class="dropdown-link">iPhone 16</a></li>
                        </ul>
                      </div>
                      <div>
                        <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-2">Generasi Sebelumnya</p>
                        <ul class="grid grid-cols-2 gap-1.5">
                          <li><a href="#" class="dropdown-link">iPhone 15 Pro</a></li>
                          <li><a href="#" class="dropdown-link">iPhone 15</a></li>
                          <li><a href="#" class="dropdown-link">iPhone 14</a></li>
                          <li><a href="#" class="dropdown-link">iPhone 13</a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Model & Aksesoris -->
                <div class="nav-item group">
                  <a href="#category" class="flex items-center gap-2 px-4 py-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition">
                    <svg class="h-5 w-5 text-white/90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><rect x="3" y="3" width="7" height="7" rx="2" /><rect x="14" y="3" width="7" height="7" rx="2" /><rect x="14" y="14" width="7" height="7" rx="2" /><rect x="3" y="14" width="7" height="7" rx="2" /></svg>
                    <span class="font-medium">Model & Aksesoris</span>
                  </a>
                  <div class="dropdown-panel absolute left-0 top-full hidden z-[95]">
                    <div class="w-[640px] max-w-[92vw] rounded-2xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-4 grid grid-cols-3 gap-3 shadow-soft">
                      <ul class="space-y-1.5">
                        <li class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Aksesoris</li>
                        <li><a href="#" class="dropdown-link">Case MagSafe</a></li>
                        <li><a href="#" class="dropdown-link">Charger MagSafe</a></li>
                        <li><a href="#" class="dropdown-link">Kabel USB-C</a></li>
                      </ul>
                      <ul class="space-y-1.5">
                        <li class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Audio</li>
                        <li><a href="#" class="dropdown-link">AirPods Pro (2)</a></li>
                        <li><a href="#" class="dropdown-link">AirPods 3</a></li>
                        <li><a href="#" class="dropdown-link">Beats</a></li>
                      </ul>
                      <ul class="space-y-1.5">
                        <li class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Lainnya</li>
                        <li><a href="#" class="dropdown-link">AppleCare+</a></li>
                        <li><a href="#" class="dropdown-link">Protector</a></li>
                        <li><a href="#" class="dropdown-link">Dock & Stand</a></li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Ulasan -->
                <div class="nav-item group">
                  <a href="#testi" class="flex items-center gap-2 px-4 py-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition">
                    <svg class="h-5 w-5 text-white/90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4Z" /></svg>
                    <span class="font-medium">Ulasan</span>
                  </a>
                  <div class="dropdown-panel absolute left-0 top-full hidden z-[95]">
                    <div class="w-[420px] max-w-[92vw] rounded-2xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-4 grid grid-cols-1 gap-2 shadow-soft">
                      <a href="#testi" class="dropdown-link">Ulasan Pelanggan</a>
                      <a href="#" class="dropdown-link">Video Review</a>
                      <a href="#" class="dropdown-link">Perbandingan Model</a>
                    </div>
                  </div>
                </div>

                <!-- Promo -->
                <div class="nav-item group">
                  <a href="#rewards" class="flex items-center gap-2 px-4 py-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition">
                    <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" /></svg>
                    <span class="font-medium">Promo</span>
                  </a>
                  <div class="dropdown-panel absolute left-0 top-full hidden z-[95]">
                    <div class="w-[520px] max-w-[92vw] rounded-2xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-4 grid grid-cols-2 gap-3 shadow-soft">
                      <a href="#rewards" class="dropdown-link">Bundling Hemat</a>
                      <a href="#rewards" class="dropdown-link">Trade-In</a>
                      <a href="#rewards" class="dropdown-link">Cicilan 0%</a>
                      <a href="#rewards" class="dropdown-link">Student Offer</a>
                    </div>
                  </div>
                </div>
              </nav>

              <!-- Right controls (desktop) -->
              <div class="hidden lg:flex items-center gap-2 relative">
                <button id="themeToggle" class="relative h-9 w-16 rounded-full bg-white/15 ring-1 ring-white/20 dark:bg-white/10 dark:ring-white/10 flex items-center px-1 transition-colors duration-500 ease-out">
                  <svg id="sunIcon" class="absolute left-1.5 h-4 w-4 text-yellow-300 transition-opacity duration-500 ease-out opacity-100 dark:opacity-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                    <circle cx="12" cy="12" r="3" />
                    <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
                  </svg>
                  <svg id="moonIcon" class="absolute right-1.5 h-4 w-4 text-slate-200 transition-opacity duration-500 ease-out opacity-0 dark:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
                  </svg>
                  <span id="themeKnob" class="h-7 w-7 rounded-full bg-white shadow translate-x-0 dark:translate-x-7 transition-transform duration-500 ease-out"></span>
                </button>

                <!-- Cart desktop trigger (anchor via JS) -->
                <button id="cartBtn" class="h-10 w-10 grid place-content-center rounded-full bg-white/10 ring-1 ring-white/10 hover:bg-white/15 transition" title="Keranjang">
                  <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="9" cy="20" r="1.8" /><circle cx="18" cy="20" r="1.8" /><path d="M3 3h2l2.4 12.5a2 2 0 0 0 2 1.6h7.7a2 2 0 0 0 2-1.6L21 7H6" /></svg>
                </button>

                <button class="px-5 py-2.5 rounded-full bg-white/10 ring-1 ring-white/20 hover:bg-white/15 transition">Masuk</button>
                <button class="px-5 py-2.5 rounded-full bg-white text-primary font-semibold hover:bg-slate-100 transition">Daftar</button>
              </div>

              <!-- MOBILE/TABLET (≤ lg-1): theme + cart + burger -->
              <div class="lg:hidden flex items-center gap-2">
                <button id="themeToggleMobile" class="h-10 w-10 grid place-content-center rounded-full bg-white/15 ring-1 ring-white/20 dark:bg-white/10 dark:ring-white/10 transition-colors duration-500 ease-out">
                  <svg class="h-5 w-5 text-white dark:text-yellow-300 transition-[color,opacity] duration-500 ease-out" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                    <path class="dark:hidden" d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/><circle class="dark:hidden" cx="12" cy="12" r="3"/>
                    <path class="hidden dark:block" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"/>
                  </svg>
                </button>

                <!-- Cart mobile trigger (di antara toggle & burger) -->
                <button id="cartBtnMobile" class="h-10 w-10 grid place-content-center rounded-full bg-white/15 ring-1 ring-white/20 hover:bg-white/20 transition" title="Keranjang">
                  <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="9" cy="20" r="1.8" /><circle cx="18" cy="20" r="1.8" /><path d="M3 3h2l2.4 12.5a2 2 0 0 0 2 1.6h7.7a2 2 0 0 0 2-1.6L21 7H6" /></svg>
                </button>

                <button class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-white/10 ring-1 ring-white/10" aria-label="Menu" id="menuBtn">
                  <svg class="h-5 w-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 6h18M3 12h18M3 18h18" /></svg>
                </button>
              </div>
            </div>

            <!-- MOBILE/TABLET MENU (accordion by click) -->
            <div id="mobileMenu" class="lg:hidden hidden mt-3 space-y-2">
              <!-- iPhone -->
              <div class="mm-item rounded-2xl bg-white/10 ring-1 ring-white/15 p-2">
                <button class="w-full flex items-center justify-between px-2 py-2">
                  <span class="flex items-center gap-2 font-medium">
                    <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M3 7h18l-1.5 11a2 2 0 0 1-2 2H6.5a2 2 0 0 1-2-1.7L3 7Z" /><path d="M8 7V4a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v3" /></svg>
                    iPhone
                  </span>
                  <svg class="mm-chevron h-4 w-4 opacity-80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="mm-panel pt-1">
                  <div class="rounded-xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-3 text-ink dark:text-slate-100">
                    <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Terbaru</p>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 16 Pro Max <span class="ml-2 text-xs text-sky">Baru</span></a>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 16 Pro</a>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 16 Plus</a>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 16</a>
                    <p class="mt-3 text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Generasi Sebelumnya</p>
                    <div class="grid grid-cols-2 gap-1">
                      <a href="#" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 15 Pro</a>
                      <a href="#" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 15</a>
                      <a href="#" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 14</a>
                      <a href="#" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">iPhone 13</a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Model & Aksesoris -->
              <div class="mm-item rounded-2xl bg-white/10 ring-1 ring-white/15 p-2">
                <button class="w-full flex items-center justify-between px-2 py-2">
                  <span class="flex items-center gap-2 font-medium">
                    <svg class="h-5 w-5 text-white/90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><rect x="3" y="3" width="7" height="7" rx="2" /><rect x="14" y="3" width="7" height="7" rx="2" /><rect x="14" y="14" width="7" height="7" rx="2" /><rect x="3" y="14" width="7" height="7" rx="2" /></svg>
                    Model & Aksesoris
                  </span>
                  <svg class="mm-chevron h-4 w-4 opacity-80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="mm-panel pt-1">
                  <div class="rounded-xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-3">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-1">
                      <div>
                        <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Aksesoris</p>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Case MagSafe</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Charger MagSafe</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Kabel USB-C</a>
                      </div>
                      <div>
                        <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Audio</p>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">AirPods Pro (2)</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">AirPods 3</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Beats</a>
                      </div>
                      <div>
                        <p class="text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1">Lainnya</p>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">AppleCare+</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Protector</a>
                        <a class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70" href="#">Dock & Stand</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Ulasan -->
              <div class="mm-item rounded-2xl bg-white/10 ring-1 ring-white/15 p-2">
                <button class="w-full flex items-center justify-between px-2 py-2">
                  <span class="flex items-center gap-2 font-medium">
                    <svg class="h-5 w-5 text-white/90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4Z" /></svg>
                    Ulasan
                  </span>
                  <svg class="mm-chevron h-4 w-4 opacity-80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="mm-panel pt-1">
                  <div class="rounded-xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-3">
                    <a href="#testi" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Ulasan Pelanggan</a>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Video Review</a>
                    <a href="#" class="block px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Perbandingan Model</a>
                  </div>
                </div>
              </div>

              <!-- Promo -->
              <div class="mm-item rounded-2xl bg-white/10 ring-1 ring-white/15 p-2">
                <button class="w-full flex items-center justify-between px-2 py-2">
                  <span class="flex items-center gap-2 font-medium">
                    <svg class="h-5 w-5 text-amber-300" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" /></svg>
                    Promo
                  </span>
                  <svg class="mm-chevron h-4 w-4 opacity-80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="mm-panel pt-1">
                  <div class="rounded-xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-3 grid grid-cols-1 sm:grid-cols-2 gap-1">
                    <a href="#rewards" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Bundling Hemat</a>
                    <a href="#rewards" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Trade-In</a>
                    <a href="#rewards" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Cicilan 0%</a>
                    <a href="#rewards" class="px-3 py-2 rounded-lg hover:bg-slate-100/70 dark:hover:bg-slate-800/70">Student Offer</a>
                  </div>
                </div>
              </div>
            </div>
            <!-- /MOBILE MENU -->
          </div>
        </div>
      </div>
    </header>

    <!-- Spacer agar konten tidak ketutup header fixed -->
    <div class="h-[96px] sm:h-[104px]"></div>

    <!-- Efek wash tema -->
    <div id="themeCurtain" class="pointer-events-none fixed inset-0 z-[70] opacity-0 hidden"></div>

    <!-- ===== CART POPOVER (global, anchored by JS; muncul di bawah tombol yang diklik) ===== -->
    <div id="cartPopover" class="hidden fixed z-[100] w-[420px] max-w-[92vw] rounded-2xl ring-1 ring-black/10 dark:ring-white/10 bg-white/95 dark:bg-slate-900/95 backdrop-blur p-4 shadow-soft">
      <div class="flex items-start justify-between mb-2">
        <p class="font-semibold">Keranjang</p>
        <button id="closeCart" class="h-8 w-8 grid place-content-center rounded-full hover:bg-slate-100/80 dark:hover:bg-slate-800/80">
          <svg class="h-5 w-5 text-slate-600 dark:text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M18 6 6 18M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="cartList" class="divide-y divide-slate-200 dark:divide-slate-800 max-h-80 overflow-auto"></div>
      <div class="mt-3 flex items-center justify-between">
        <p class="font-semibold">Total</p>
        <p id="cartTotal" class="font-bold text-sky">Rp 0</p>
      </div>
      <div class="mt-3 grid grid-cols-2 gap-2">
        <button id="checkoutBtn" class="px-4 py-2 rounded-xl bg-sky text-white font-semibold">Checkout</button>
        <button id="clearCartBtn" class="px-4 py-2 rounded-xl ring-1 ring-black/10 dark:ring-white/10">Kosongkan</button>
      </div>
    </div>

    <div class="min-h-screen py-6 sm:py-10">
      <div class="mx-auto max-w-[1200px] rounded-3xl shadow-soft bg-white dark:bg-slate-900 overflow-hidden">
        <!-- HERO -->
        <section class="relative px-5 sm:px-10 pt-10 pb-8 bg-white dark:bg-slate-900">
          <!-- Pill -->
          <div class="inline-flex items-center gap-2 text-sm bg-slateSoft dark:bg-slate-800/60 rounded-full px-4 py-2 ring-1 ring-black/5 dark:ring-white/10">
            <span class="h-6 w-6 grid place-content-center rounded-full bg-amber-100 text-amber-600">
              <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2 2 7l10 5 10-5-10-5Z" /></svg>
            </span>
            <span class="text-slate-600 dark:text-slate-300">Best Seller: iPhone 16 Pro Max</span>
          </div>

          <div class="mt-6 grid lg:grid-cols-2 gap-10 items-center relative">
            <!-- Left copy -->
            <div>
              <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight text-ink dark:text-white">
                Upgrade ke <span class="text-sky">iPhone 16 Pro Max</span>
              </h1>
              <p class="mt-3 text-slate-600 dark:text-slate-300 max-w-xl">
                Performa A18 Pro, kamera Pro, dan desain Titanium. Garansi resmi, opsi cicilan 0%, dan tukar-tambah mudah.
              </p>
              <div class="mt-6 flex items-center gap-3">
                <button
                  data-addcart
                  data-pid="ip16pm"
                  data-title="iPhone 16 Pro Max"
                  data-price="25999000"
                  data-img="https://images.unsplash.com/photo-1557180295-76eee20ae8aa?q=80&w=1200&auto=format&fit=crop"
                  class="px-6 py-3 rounded-full bg-sky text-white font-semibold shadow-glow hover:translate-y-[-1px] transition"
                >Beli Sekarang</button>
                <button class="px-6 py-3 rounded-full ring-1 ring-black/10 dark:ring-white/10 text-ink dark:text-white bg-white dark:bg-transparent hover:bg-slateSoft/60 dark:hover:bg-slate-800/60 transition">Lihat Detail</button>
              </div>
            </div>

            <!-- Right banner: iPhone back + 3D cursor parallax -->
            <div id="heroWrap" class="relative">
              <!-- blobs -->
              <div class="absolute inset-0" aria-hidden="true">
                <div class="absolute h-64 w-64 rounded-full blur-3xl bg-sky/30 top-[-20%] left-[-5%] animate-blob"></div>
                <div class="absolute h-72 w-72 rounded-full blur-3xl bg-indigo-400/30 bottom-[-10%] right-0 animate-blob2"></div>
                <div class="absolute h-60 w-60 rounded-full blur-3xl bg-amber-200/40 top-[30%] right-[35%] animate-blob3"></div>
              </div>

              <!-- 3D SCENE (16:9) -->
              <div id="hero3d" class="persp-1200 relative z-10 rounded-[2rem] aspect-video">
                <div id="card3d" class="edge-soft scene-3d relative w-full h-full transition-transform duration-700 ease-[cubic-bezier(.2,.8,.2,1)]" style="transform: translateZ(0.001px);">
                  <!-- iPhone 16 Pro Max (belakang) -->
                  <img
                    id="iphoneImg"
                    class="absolute inset-0 m-auto w-[72%] max-w-[780px] no-select z-50deg"
                    style="transform: translateZ(55px); filter: drop-shadow(0 40px 70px rgba(0,0,0,.35));"
                    src="iphone.png"
                    alt="iPhone 16 Pro Max — Titanium Finish"
                  />

                  <!-- Gloss highlight -->
                  <div id="gloss" class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-500"
                       style="background: radial-gradient(300px 220px at 50% 50%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%); transform: translateZ(65px);">
                  </div>
                </div>

                <!-- Vignette non-rotating -->
                <div class="edge-vignette"></div>
              </div>

              <!-- BADGES (melayang) -->
              <div class="absolute top-4 left-4 bg-white/90 dark:bg-slate-900/90 backdrop-blur rounded-xl px-3 py-2 text-xs sm:text-sm shadow-soft ring-1 ring-black/5 dark:ring-white/10 flex items-center gap-2">
                <span class="h-6 w-6 grid place-content-center rounded-lg bg-sky/10 text-sky">
                  <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M2 12h20M12 2v20" /></svg>
                </span>
                <div>
                  <p class="font-semibold text-ink dark:text-white leading-none">Titanium Finish</p>
                  <p class="text-slate-500 dark:text-slate-300 leading-none mt-0.5">iPhone 16 Pro Max</p>
                </div>
              </div>

              <div class="absolute right-4 top-6 bg-white/90 dark:bg-slate-900/90 backdrop-blur rounded-xl px-3 py-2 text-xs sm:text-sm shadow-soft ring-1 ring-black/5 dark:ring-white/10 flex items-center gap-2">
                <span class="h-8 w-8 grid place-content-center rounded-full bg-amber-100 text-amber-600">
                  <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" /></svg>
                </span>
                <div class="whitespace-nowrap">
                  <p class="font-semibold leading-none text-ink dark:text-white">Termasuk</p>
                  <p class="text-slate-500 dark:text-slate-300 leading-none mt-0.5">Garansi Resmi</p>
                </div>
              </div>

              <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 w-4/5 h-8 bg-sky/30 blur-2xl rounded-full"></div>
            </div>
          </div>

          <!-- MINI REVIEWS -->
          <ul id="testi" class="mt-10 grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
            <li class="flex items-center gap-3 p-3 rounded-xl ring-1 ring-black/5 dark:ring-white/10 bg-white dark:bg-slate-800">
              <img class="h-9 w-9 rounded-full object-cover" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop" alt="avatar" />
              <div><p class="font-medium text-ink dark:text-white">Baterai awet banget!</p><p class="text-slate-500 dark:text-slate-300">Jemmie P.</p></div>
            </li>
            <li class="flex items-center gap-3 p-3 rounded-xl ring-1 ring-black/5 dark:ring-white/10 bg-white dark:bg-slate-800">
              <img class="h-9 w-9 rounded-full object-cover" src="https://images.unsplash.com/photo-1547425260-76eee20ae8aa?q=80&w=200&auto=format&fit=crop" alt="avatar" />
              <div><p class="font-medium text-ink dark:text-white">Harga bundling hemat 25%</p><p class="text-slate-500 dark:text-slate-300">Angga R.</p></div>
            </li>
            <li class="flex items-center gap-3 p-3 rounded-xl ring-1 ring-black/5 dark:ring-white/10 bg-white dark:bg-slate-800">
              <img class="h-9 w-9 rounded-full object-cover" src="https://images.unsplash.com/photo-1546525848-3ce03ca516f6?q=80&w=200&auto=format&fit=crop" alt="avatar" />
              <div><p class="font-medium text-ink dark:text-white">Service center cepat</p><p class="text-slate-500 dark:text-slate-300">Petina M.</p></div>
            </li>
            <li class="flex items-center gap-3 p-3 rounded-xl ring-1 ring-black/5 dark:ring-white/10 bg-white dark:bg-slate-800">
              <img class="h-9 w-9 rounded-full object-cover" src="https://images.unsplash.com/photo-1544005313-ff3b8be3b9a6?q=80&w=200&auto=format&fit=crop" alt="avatar" />
              <div><p class="font-medium text-ink dark:text-white">Paling worth it!</p><p class="text-slate-500 dark:text-slate-300">Udin S.</p></div>
            </li>
          </ul>
        </section>

        <!-- DIVIDER -->
        <div class="h-5 bg-[#EAF0FF] dark:bg-slate-800/60"></div>

        <!-- CATEGORY SECTION -->
        <section id="category" class="px-5 sm:px-10 py-10 bg-white dark:bg-slate-900">
          <div class="flex items-end justify-between">
            <div>
              <h2 class="text-2xl sm:text-3xl font-extrabold">Belanja iPhone</h2>
              <p class="text-slate-600 dark:text-slate-300 -mt-1">Model & Aksesoris Resmi</p>
            </div>
            <button class="hidden sm:inline-flex items-center gap-2 px-4 py-2 rounded-full bg-pastel2 ring-1 ring-sky/20 text-sky hover:bg-pastel2/80">
              Lihat Semua
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M5 12h14M13 5l7 7-7 7" /></svg>
            </button>
          </div>

          <div class="mt-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-5">
            <!-- Kategori + tombol tambah untuk demo keranjang -->
            <div class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 p-4 shadow-soft bg-white dark:bg-slate-800">
              <div class="h-44 rounded-xl bg-slateSoft dark:bg-slate-700 grid place-content-center overflow-hidden">
                <img src="https://images.unsplash.com/photo-1557180295-76eee20ae8aa?q=80&w=1200&auto=format&fit=crop" class="h-full object-contain" alt="iPhone 16" />
              </div>
              <div class="mt-4">
                <p class="font-semibold">iPhone 16</p>
                <p class="text-xs text-slate-500 dark:text-slate-300">Smartphone</p>
                <p class="mt-2 font-bold text-sky">Rp 14.999.000</p>
                <button
                  data-addcart
                  data-pid="ip16"
                  data-title="iPhone 16"
                  data-price="14999000"
                  data-img="https://images.unsplash.com/photo-1557180295-76eee20ae8aa?q=80&w=1200&auto=format&fit=crop"
                  class="mt-3 w-full px-4 py-2 rounded-xl bg-sky text-white"
                >Tambah ke Keranjang</button>
              </div>
            </div>

            <div class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 p-4 shadow-soft bg-white dark:bg-slate-800">
              <div class="h-44 rounded-xl bg-slateSoft dark:bg-slate-700 grid place-content-center overflow-hidden">
                <img src="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1200&auto=format&fit=crop" class="h-full object-contain" alt="MacBook Pro" />
              </div>
              <div class="mt-4">
                <p class="font-semibold">MacBook Pro 14"</p>
                <p class="text-xs text-slate-500 dark:text-slate-300">Laptop</p>
                <p class="mt-2 font-bold text-sky">Rp 28.999.000</p>
                <button
                  data-addcart
                  data-pid="mbp14"
                  data-title="MacBook Pro 14”"
                  data-price="28999000"
                  data-img="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1200&auto=format&fit=crop"
                  class="mt-3 w-full px-4 py-2 rounded-xl bg-sky text-white"
                >Tambah ke Keranjang</button>
              </div>
            </div>

            <div class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 p-4 shadow-soft bg-white dark:bg-slate-800">
              <div class="h-44 rounded-xl bg-slateSoft dark:bg-slate-700 grid place-content-center overflow-hidden">
                <img src="https://images.unsplash.com/photo-1580910051074-3eb694886505?q=80&w=1200&auto=format&fit=crop" class="h-full object-contain" alt="AirPods Pro 2" />
              </div>
              <div class="mt-4">
                <p class="font-semibold">AirPods Pro (2)</p>
                <p class="text-xs text-slate-500 dark:text-slate-300">Audio</p>
                <p class="mt-2 font-bold text-sky">Rp 3.999.000</p>
                <button
                  data-addcart
                  data-pid="airpods2"
                  data-title="AirPods Pro (2)"
                  data-price="3999000"
                  data-img="https://images.unsplash.com/photo-1580910051074-3eb694886505?q=80&w=1200&auto=format&fit=crop"
                  class="mt-3 w-full px-4 py-2 rounded-xl bg-sky text-white"
                >Tambah ke Keranjang</button>
              </div>
            </div>

            <div class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 p-4 shadow-soft bg-white dark:bg-slate-800">
              <div class="h-44 rounded-xl bg-slateSoft dark:bg-slate-700 grid place-content-center overflow-hidden">
                <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop" class="h-full object-contain" alt="iMac 24" />
              </div>
              <div class="mt-4">
                <p class="font-semibold">iMac 24”</p>
                <p class="text-xs text-slate-500 dark:text-slate-300">Desktop</p>
                <p class="mt-2 font-bold text-sky">Rp 24.999.000</p>
                <button
                  data-addcart
                  data-pid="imac24"
                  data-title="iMac 24”"
                  data-price="24999000"
                  data-img="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop"
                  class="mt-3 w-full px-4 py-2 rounded-xl bg-sky text-white"
                >Tambah ke Keranjang</button>
              </div>
            </div>
          </div>

          <div class="mt-4 sm:hidden">
            <button class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full bg-pastel2 ring-1 ring-sky/20 text-sky">
              Lihat Semua
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M5 12h14M13 5l7 7-7 7" /></svg>
            </button>
          </div>
        </section>

        <!-- FOOTER -->
        <footer id="rewards" class="px-5 sm:px-10 py-10 bg-white dark:bg-slate-900 border-t border-black/5 dark:border-white/10 rounded-b-3xl">
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <h3 class="text-xl font-bold">Promo & Program Trade-In</h3>
              <p class="text-slate-600 dark:text-slate-300 mt-2">Tukar iPhone lama kamu, hemat hingga jutaan untuk upgrade ke iPhone 16 Series.</p>
              <ul class="mt-3 text-slate-600 dark:text-slate-300 space-y-1">
                <li>Garansi resmi & dukungan Apple Service</li>
                <li>Cicilan 0% s/d 24 bulan</li>
                <li>Gratis ongkir & pengembalian mudah</li>
              </ul>
            </div>
            <div class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 bg-gradient-to-br from-slateSoft to-white dark:from-slate-800 dark:to-slate-900 p-6">
              <div class="flex items-center gap-4">
                <div class="h-12 w-12 rounded-2xl bg-amber-100 text-amber-600 grid place-content-center">
                  <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2" /><path d="m12 2-2.81 6.63L2 9.24l5.46 4.73L5.82 21z" /></svg>
                </div>
                <div>
                  <p class="font-semibold">Bonus Poin Member</p>
                  <p class="text-slate-600 dark:text-slate-300 text-sm">Dapatkan 2x poin untuk pembelian iPhone bulan ini.</p>
                </div>
              </div>
              <div class="mt-4 flex gap-3">
                <button class="px-5 py-2.5 rounded-full bg-sky text-white font-semibold shadow-glow">Gabung Sekarang</button>
                <button class="px-5 py-2.5 rounded-full ring-1 ring-black/10 dark:ring-white/10 bg-white dark:bg-transparent">Pelajari</button>
              </div>
            </div>
          </div>

          <div class="mt-10 text-center text-slate-500 dark:text-slate-400 text-sm">© 2025 iPhone Store. All rights reserved.</div>
        </footer>
      </div>
    </div>

    <!-- Floating toggle: HANYA DESKTOP -->
    <button id="floatingToggle" class="hidden xl:grid fixed bottom-4 right-4 z-[50] h-12 w-12 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur ring-1 ring-black/10 dark:ring-white/10 place-content-center shadow-soft transition-colors duration-500 ease-out">
      <svg class="h-6 w-6 text-ink dark:text-yellow-300 transition-[color,opacity] duration-500 ease-out" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path class="dark:hidden" d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/><circle class="dark:hidden" cx="12" cy="12" r="3"/>
        <path class="hidden dark:block" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"/>
      </svg>
    </button>

    <script>
      // ===== Header blur + state scrolled =====
      const siteHeader = document.getElementById("siteHeader");
      const setHeaderScrolled = () => {
        if (window.scrollY > 8) siteHeader.classList.add("is-scrolled");
        else siteHeader.classList.remove("is-scrolled");
      };
      setHeaderScrolled();
      window.addEventListener("scroll", setHeaderScrolled, { passive: true });

      // ===== Mobile menu toggle =====
      const menuBtn = document.getElementById("menuBtn");
      const mobileMenu = document.getElementById("mobileMenu");
      menuBtn?.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));

      // ===== Mobile accordion (open by click) =====
      const mmItems = Array.from(document.querySelectorAll('#mobileMenu .mm-item'));
      function mmCloseAll(except=null){ mmItems.forEach(it => { if(it!==except) it.classList.remove('open'); }); }
      mmItems.forEach(it=>{
        const btn = it.querySelector('button');
        btn.addEventListener('click', ()=>{
          const isOpen = it.classList.contains('open');
          mmCloseAll();
          if(!isOpen) it.classList.add('open'); else it.classList.remove('open');
        });
      });

      // ===== Theme helpers (toggle 0.5s) =====
      const root = document.documentElement;
      const curtain = document.getElementById("themeCurtain");
      const setKnob = () => {
        const dark = root.classList.contains("dark");
        document.getElementById("themeKnob")?.classList.toggle("translate-x-7", dark);
        document.getElementById("sunIcon")?.classList.toggle("opacity-0", dark);
        document.getElementById("moonIcon")?.classList.toggle("opacity-100", dark);
      };
      const animateThemeWash = (toDark) => {
        curtain.classList.remove("hidden");
        curtain.style.opacity = 0;
        curtain.style.background = toDark
          ? "radial-gradient(80% 80% at 50% 30%, rgba(0,0,0,.65), rgba(0,0,0,.85))"
          : "radial-gradient(80% 80% at 50% 30%, rgba(255,255,255,.85), rgba(255,255,255,.65))";
        requestAnimationFrame(() => {
          curtain.style.opacity = 0.6;
          requestAnimationFrame(() => {
            curtain.style.opacity = 0;
            setTimeout(() => curtain.classList.add("hidden"), 700);
          });
        });
      };
      const toggleTheme = () => {
        const toDark = !root.classList.contains("dark");
        root.classList.add("theme-changing");
        root.classList.toggle("dark");
        localStorage.setItem("theme", root.classList.contains("dark") ? "dark" : "light");
        setKnob();
        animateThemeWash(toDark);
        setTimeout(() => root.classList.remove("theme-changing"), 700);
      };
      document.getElementById("themeToggle")?.addEventListener("click", toggleTheme);
      document.getElementById("themeToggleMobile")?.addEventListener("click", toggleTheme);
      document.getElementById("floatingToggle")?.addEventListener("click", toggleTheme);
      setKnob();

      // ===== 3D iPhone banner (cursor-follow) =====
      const hero3d = document.getElementById("hero3d");
      const card3d = document.getElementById("card3d");
      const gloss = document.getElementById("gloss");
      let rx = 0, ry = 0, targetRX = 0, targetRY = 0, raf;

      function animate() {
        rx += (targetRX - rx) * 0.08;
        ry += (targetRY - ry) * 0.08;
        card3d.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
        raf = requestAnimationFrame(animate);
      }
      function handleMove(e) {
        const rect = hero3d.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const x = ("touches" in e ? e.touches[0].clientX : e.clientX) - cx;
        const y = ("touches" in e ? e.touches[0].clientY : e.clientY) - cy;
        const maxY = 16, maxX = 10;
        targetRY = (x / (rect.width / 2)) * maxY;
        targetRX = (-y / (rect.height / 2)) * maxX;
        const px = ((x / (rect.width / 2)) * 50 + 50).toFixed(2);
        const py = ((y / (rect.height / 2)) * 50 + 50).toFixed(2);
        gloss.style.opacity = 1;
        gloss.style.background = `radial-gradient(280px 200px at ${px}% ${py}%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%)`;
      }
      function reset3D() { targetRX = 0; targetRY = 0; gloss.style.opacity = 0; }
      hero3d.addEventListener("mouseenter", () => { cancelAnimationFrame(raf); raf = requestAnimationFrame(animate); });
      hero3d.addEventListener("mousemove", handleMove);
      hero3d.addEventListener("mouseleave", reset3D);
      hero3d.addEventListener("touchstart", (e) => { handleMove(e); raf = requestAnimationFrame(animate); }, { passive: true });
      hero3d.addEventListener("touchmove", handleMove, { passive: true });
      hero3d.addEventListener("touchend", reset3D);
      if (matchMedia("(pointer: coarse)").matches) {
        let t = 0;
        setInterval(() => {
          targetRY = Math.sin(t) * 6;
          targetRX = Math.cos(t * 1.2) * 4;
          t += 0.05;
          raf = requestAnimationFrame(animate);
        }, 80);
      }

      // ===== CART STATE & POPOVER =====
      const cartPopover = document.getElementById('cartPopover');
      const closeCart = document.getElementById('closeCart');
      const cartList = document.getElementById('cartList');
      const cartTotal = document.getElementById('cartTotal');
      const checkoutBtn = document.getElementById('checkoutBtn');
      const clearCartBtn = document.getElementById('clearCartBtn');
      const cartBtnDesktop = document.getElementById('cartBtn');
      const cartBtnMobile = document.getElementById('cartBtnMobile');

      const rupiah = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n).replace('IDR', 'Rp');
      /** @type {{id:string,title:string,price:number,qty:number,img:string}[]} */
      let cart = [];

      function renderCart(){
        cartList.innerHTML = '';
        if(cart.length === 0){
          cartList.innerHTML = '<div class="py-6 text-center text-slate-500 dark:text-slate-400">Keranjang kosong</div>';
          cartTotal.textContent = 'Rp 0';
          return;
        }
        let total = 0;
        cart.forEach(item=>{
          total += item.price * item.qty;
          const row = document.createElement('div');
          row.className = 'py-3 flex items-center gap-3';
          row.innerHTML = `
            <img src="${item.img}" alt="${item.title}" class="h-12 w-12 rounded-xl object-cover ring-1 ring-black/5 dark:ring-white/10">
            <div class="flex-1">
              <p class="font-medium">${item.title}</p>
              <p class="text-xs text-slate-500 dark:text-slate-400">${item.qty} × ${rupiah(item.price)}</p>
            </div>
            <div class="flex items-center gap-2">
              <button aria-label="Kurangi" data-dec="${item.id}" class="h-8 w-8 grid place-content-center rounded-full ring-1 ring-black/10 dark:ring-white/10 hover:bg-slate-100/80 dark:hover:bg-slate-800/80">–</button>
              <button aria-label="Tambah" data-inc="${item.id}" class="h-8 w-8 grid place-content-center rounded-full ring-1 ring-black/10 dark:ring-white/10 hover:bg-slate-100/80 dark:hover:bg-slate-800/80">+</button>
              <button aria-label="Hapus" data-del="${item.id}" class="h-8 w-8 grid place-content-center rounded-full hover:bg-rose-100/70 dark:hover:bg-rose-900/30">
                <svg class="h-4 w-4 text-rose-600 dark:text-rose-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 6h18M8 6v12m4-12v12m4-12v12M5 6l1-3h12l1 3"/></svg>
              </button>
            </div>
          `;
          cartList.appendChild(row);
        });
        cartTotal.textContent = rupiah(total);
      }

      function addToCart({id,title,price,img}){
        const found = cart.find(i=>i.id===id);
        if(found) found.qty += 1;
        else cart.push({id,title,price:Number(price),qty:1,img});
        renderCart();
      }

      // Delegasi tombol tambah dari kartu produk
      document.addEventListener('click', (e)=>{
        const add = e.target.closest('[data-addcart]');
        if(add){
          addToCart({
            id: add.dataset.pid,
            title: add.dataset.title,
            price: add.dataset.price,
            img: add.dataset.img
          });
          openCart(getPreferredCartAnchor());
        }
      });

      // Kendali qty di dalam popover — stopPropagation agar tidak menutup popover
      cartList.addEventListener('click', (e)=>{
        const dec = e.target.closest('[data-dec]');
        const inc = e.target.closest('[data-inc]');
        const del = e.target.closest('[data-del]');
        if(dec || inc || del){ e.stopPropagation(); }
        if(dec){
          const id = dec.getAttribute('data-dec');
          const item = cart.find(i=>i.id===id);
          if(item){ item.qty = Math.max(1, item.qty-1); renderCart(); }
        }
        if(inc){
          const id = inc.getAttribute('data-inc');
          const item = cart.find(i=>i.id===id);
          if(item){ item.qty += 1; renderCart(); }
        }
        if(del){
          const id = del.getAttribute('data-del');
          cart = cart.filter(i=>i.id!==id);
          renderCart();
        }
      });

      function getPreferredCartAnchor(){
        // Jika layar besar, pakai tombol desktop; selain itu tombol mobile
        if (window.innerWidth >= 1024 && cartBtnDesktop) return cartBtnDesktop;
        return cartBtnMobile || cartBtnDesktop;
      }

      function openCart(anchorBtn){
        renderCart();
        cartPopover.classList.remove('hidden');
        const r = anchorBtn.getBoundingClientRect();
        const pad = 8;
        const pw = Math.min(420, window.innerWidth - pad*2);
        cartPopover.style.width = pw + 'px';
        cartPopover.style.position = 'fixed';
        let left = Math.min(r.right - pw, window.innerWidth - pw - pad);
        left = Math.max(pad, left);
        const top = Math.min(r.bottom + 8, window.innerHeight - cartPopover.offsetHeight - pad);
        cartPopover.style.left = left + 'px';
        cartPopover.style.top = Math.max(pad, top) + 'px';
      }
      function closeCartPopover(){ cartPopover.classList.add('hidden'); }

      // Triggers (desktop & mobile)
      cartBtnDesktop?.addEventListener('click', (e)=>{ e.stopPropagation(); openCart(cartBtnDesktop); });
      cartBtnMobile?.addEventListener('click', (e)=>{ e.stopPropagation(); openCart(cartBtnMobile); });
      document.getElementById('closeCart')?.addEventListener('click', (e)=>{ e.stopPropagation(); closeCartPopover(); });

      // klik di luar -> tutup
      document.addEventListener('pointerdown', (e)=>{
        if(cartPopover.classList.contains('hidden')) return;
        const path = e.composedPath ? e.composedPath() : [];
        const inside = path.includes(cartPopover) || path.includes(cartBtnDesktop) || path.includes(cartBtnMobile);
        if(!inside) closeCartPopover();
      });
      // Escape -> tutup
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeCartPopover(); });

      // ===== Dropdown controller desktop (≥ lg): hanya satu yang terbuka & auto-close =====
      const navItems = Array.from(document.querySelectorAll('.lg\\:flex .nav-item')); // hanya untuk desktop
      let ddCloseTimer = null;

      function closeAll(except = null) {
        navItems.forEach(it => { if (it !== except) it.classList.remove('open'); });
      }

      navItems.forEach(it => {
        const panel = it.querySelector('.dropdown-panel');
        it.addEventListener('pointerenter', () => {
          clearTimeout(ddCloseTimer);
          closeAll(it);
          it.classList.add('open');
        });
        it.addEventListener('pointerleave', () => {
          ddCloseTimer = setTimeout(() => it.classList.remove('open'), 120);
        });
        it.addEventListener('focusin', () => {
          clearTimeout(ddCloseTimer);
          closeAll(it);
          it.classList.add('open');
        });
        it.addEventListener('focusout', () => {
          ddCloseTimer = setTimeout(() => {
            if (!it.contains(document.activeElement)) it.classList.remove('open');
          }, 120);
        });
        panel?.addEventListener('click', (e) => {
          const link = e.target.closest('a');
          if (link) it.classList.remove('open');
        });
      });

      // Klik di luar header => tutup dropdown desktop
      document.addEventListener('pointerdown', (e) => {
        if (!siteHeader.contains(e.target)) closeAll();
      });
    </script>
  </body>
</html>
